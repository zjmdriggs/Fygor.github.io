<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0043)http://pygments.org/demo/6324310/?style=vim -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=">
    
    <title>Pygments — Pygments</title>
    
    <link rel="stylesheet" href="./Pygments — Pygments_files/pygments14.css" type="text/css">
    <link rel="stylesheet" href="./Pygments — Pygments_files/pygments.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '/',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="./Pygments — Pygments_files/jquery.js"></script>
    <script type="text/javascript" src="./Pygments — Pygments_files/underscore.js"></script>
    <script type="text/javascript" src="./Pygments — Pygments_files/doctools.js"></script>
    
    
    <link rel="shortcut icon" href="http://pygments.org/_static/favicon.ico">
    <link rel="top" title="Pygments documentation" href="http://pygments.org/">
    <link href="./Pygments — Pygments_files/css" rel="stylesheet" type="text/css">
    <script type="text/javascript">
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>
  </head>
  <body role="document">
    <div class="outerwrapper">
      <div class="pageheader">
        <ul>
          <li><a href="http://pygments.org/">Home</a></li>
          <li><a href="http://pygments.org/demo/">Demo</a></li>
          <li><a href="http://pygments.org/languages/">Languages</a></li>
          <li><a href="http://pygments.org/faq/">FAQ</a></li>
          <li><a href="http://pygments.org/download/">Get it</a></li>
          <li><a href="http://pygments.org/docs/">Docs</a></li>
        </ul>
        <div>
          <a href="http://pygments.org/">
            <img src="./Pygments — Pygments_files/logo.png" alt="Pygments logo">
          </a>
       </div>
     </div>
    

    <div class="document">
      <div class="documentwrapper">
        <div class="fullbodywrapper">
          <div class="body" role="main">
            
<h1 class="heading">Demo entry 6324310</h1>

<p><strong>Client file form A-Game-Of-Codes Project</strong></p>

<form action="http://pygments.org/demo/6324310/" method="get" name="filter_form" id="filter_form">
  <p style="margin-top: 0"><label for="style">Use this style:</label> &nbsp;
    <select id="style" name="style" onchange="document.forms.filter_form.submit()">
      
      <option value="manni">manni</option>
      
      <option value="igor">igor</option>
      
      <option value="lovelace">lovelace</option>
      
      <option value="xcode">xcode</option>
      
      <option value="vim" selected="selected">vim</option>
      
      <option value="autumn">autumn</option>
      
      <option value="vs">vs</option>
      
      <option value="rrt">rrt</option>
      
      <option value="native">native</option>
      
      <option value="perldoc">perldoc</option>
      
      <option value="borland">borland</option>
      
      <option value="tango">tango</option>
      
      <option value="emacs">emacs</option>
      
      <option value="friendly">friendly</option>
      
      <option value="monokai">monokai</option>
      
      <option value="paraiso-dark">paraiso-dark</option>
      
      <option value="colorful">colorful</option>
      
      <option value="murphy">murphy</option>
      
      <option value="bw">bw</option>
      
      <option value="pastie">pastie</option>
      
      <option value="algol_nu">algol_nu</option>
      
      <option value="paraiso-light">paraiso-light</option>
      
      <option value="trac">trac</option>
      
      <option value="default">default</option>
      
      <option value="algol">algol</option>
      
      <option value="fruity">fruity</option>
      
    </select> &nbsp;
    <input type="submit" value="Go">
  </p>
</form>

<p>Submitted by <strong>anonymous</strong>
  on Nov 15, 2016 at 23:48 <br>
  Language: Python 3. Code size: 56.8 kB.
</p>



<div class="hlcode">
<div class="syntax"><pre><span></span><span class="sd">"""The client communicates with the server and acts as a node in the peer to </span>
<span class="sd">peer network."""</span>

<span class="kn">from</span> <span class="nn">tkinter</span> <span class="k">import</span> <span class="o">*</span>           <span class="c1">#Import GUI Libraries</span>
<span class="kn">from</span> <span class="nn">tkinter.ttk</span> <span class="k">import</span> <span class="o">*</span>       <span class="c1">#Import more GUI Libraries</span>
<span class="kn">from</span> <span class="nn">tkinter.scrolledtext</span> <span class="k">import</span> <span class="n">ScrolledText</span>   <span class="c1">#A specific GUI element</span>
<span class="kn">from</span> <span class="nn">ServerComms</span> <span class="k">import</span> <span class="o">*</span>       <span class="c1">#ServerComms for server communication</span>
<span class="kn">from</span> <span class="nn">Encrypt</span> <span class="k">import</span> <span class="o">*</span>           <span class="c1">#Encrypt to allow encryption</span>
<span class="kn">from</span> <span class="nn">XOR</span> <span class="k">import</span> <span class="o">*</span>               <span class="c1">#XOR to allow the XORProtocol</span>
<span class="kn">from</span> <span class="nn">Protocols</span> <span class="k">import</span> <span class="o">*</span>         <span class="c1">#Protocols for NoneProtocol and ReverseProtocol</span>
<span class="kn">from</span> <span class="nn">DH</span> <span class="k">import</span> <span class="o">*</span>                <span class="c1">#DH for Diffie-Hellman Protocol</span>
<span class="kn">import</span> <span class="nn">socket</span>                   <span class="c1">#Socket to create server comms</span>
<span class="kn">import</span> <span class="nn">random</span>                   <span class="c1">#Random to allow random number generation</span>

<span class="n">PORT</span> <span class="o">=</span> <span class="mi">12345</span>    <span class="c1">#Arbitrary port for server comms</span>

<span class="c1">#This file has the capability to run a client and operate as a node of the </span>
<span class="c1">#   peer to peer network and communicate with the other players.</span>

<span class="k">class</span> <span class="nc">GameClient</span><span class="p">(</span><span class="n">ServerListener</span><span class="p">):</span>
    <span class="sd">"""A game client operates the peer to peer node and communications</span>
<span class="sd">    </span>
<span class="sd">    The GameClient will listen to the server and create a server node in the </span>
<span class="sd">    peer to peer network. The client interacts with the GUI component to manage</span>
<span class="sd">    communications and allow the player to interact with other nodes in the </span>
<span class="sd">    network</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        client: Connection to the server.</span>
<span class="sd">        connections: Socket connections to the other players and server saved as</span>
<span class="sd">            either UserThread or ClientThread's.</span>
<span class="sd">        client_interface: GUI Component of the interface as a ClientInterface.</span>
<span class="sd">        server: The client's server node to allow other players to connect to </span>
<span class="sd">            and communicate with this node.</span>
<span class="sd">    """</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">client_interface</span><span class="p">):</span>
        <span class="sd">"""Creates a GameClient and initializes fields.</span>

<span class="sd">        Args:</span>
<span class="sd">            client: ClientThread object that has been connected to a server.</span>
<span class="sd">            client_interface: ClientInterface GUI to communicate to the user.</span>
<span class="sd">        """</span>
        <span class="c1">#Initialize fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span> <span class="o">=</span> <span class="n">client_interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conversations</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">message_received</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
        <span class="sd">"""This fuction will parse a message received from connections</span>
<span class="sd">        </span>
<span class="sd">        Depending on who sent the message, the message is read differently </span>
<span class="sd">        depending on whether the server or another client sent the message.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            message: Message sent by the user</span>
<span class="sd">            sender: ClientThread or UserThread that received the message.</span>
<span class="sd">        """</span>
        <span class="c1">#Boolean to determine whether the message should be displayed</span>
        <span class="nb">sorted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#If the message was sent by the server</span>
        <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
            <span class="c1">#If the message contains the codename... assign codename</span>
            <span class="k">if</span> <span class="s2">"Your codename is"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">codename</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="s2">"Codename: "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="c1">#If the assigned port in the message, create server on given port</span>
            <span class="k">elif</span> <span class="s2">"Your port is"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="c1">#Parse port</span>
                <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)])</span>
                <span class="c1">#Create and start the server</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">AcceptThread</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">you</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">start_accepting</span><span class="p">()</span>
            <span class="c1">#If instructed to forget token, forget token </span>
            <span class="k">elif</span> <span class="s2">"Forget token"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">set_token_text</span><span class="p">(</span><span class="s2">"No token yet"</span><span class="p">)</span>
            <span class="c1">#If instructed to connect to another user, attempt to connect with a</span>
            <span class="c1">#   ClientThread and establish two way communications</span>
            <span class="k">elif</span> <span class="s2">"Connect to:"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="c1">#Create socket</span>
                <span class="n">conn</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
                <span class="c1">#Parse address</span>
                <span class="n">addr</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">":"</span><span class="p">)</span>
                <span class="c1">#Connect to the client</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
                <span class="c1">#Create ClientThread and save it in the list</span>
                <span class="n">thread</span> <span class="o">=</span> <span class="n">ClientThread</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="p">[</span><span class="bp">self</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"Connected to neighbor "</span> <span class="o">+</span> <span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">display_neighbors</span><span class="p">()</span>
            <span class="c1">#If a player joined the network, register him or her as a player</span>
            <span class="k">elif</span> <span class="s2">"Player joined"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">all_players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">display_players</span><span class="p">()</span>
            <span class="c1">#If a player left the network, remove him or her from the list</span>
            <span class="k">elif</span> <span class="s2">"Player left"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="c1">#Parse name</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)]</span>
                <span class="c1">#Remove it from the list if it is there.</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">all_players</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">all_players</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">display_players</span><span class="p">()</span>
            <span class="c1">#If the server sends a list of connected players, parse it and add </span>
            <span class="c1">#   the list to the current list of players.</span>
            <span class="k">elif</span> <span class="s2">"Currently connected"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"["</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"]"</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">all_players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">name</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">display_players</span><span class="p">()</span>
            <span class="c1">#If the server is sending a token, register the token as this user's</span>
            <span class="c1">#   token and display it to the user.</span>
            <span class="k">elif</span> <span class="s2">"Token"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="c1">#Parse token</span>
                <span class="n">token</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"("</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">")"</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1">#Display token</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">set_token_text</span><span class="p">(</span><span class="s2">"Send "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="s2">" to "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
            <span class="c1">#If the message did not meet any of these tags, assume it is part of</span>
            <span class="c1">#   a conversation and attempt to find the tag.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#Parse tag</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"&lt;"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"&gt;"</span><span class="p">)]</span>
                <span class="c1">#Find the corresponding conversation and forward the message</span>
                <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">PlayerConversation</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">conversation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conversations</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">conversation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">tag</span><span class="p">:</span>
                            <span class="c1">#If a conversation is found, set sorted to true so the</span>
                            <span class="c1">#   message will not display in the general feed</span>
                            <span class="nb">sorted</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">conversation</span><span class="o">.</span><span class="n">accept_input</span><span class="p">(</span><span class="s2">"Server&gt; "</span> <span class="o">+</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"&gt;"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>
        <span class="c1">#If the sender is one of the neighbors</span>
        <span class="k">elif</span> <span class="n">sender</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
            <span class="c1">#If requesting a name, send the user's name as a resopnse</span>
            <span class="k">if</span> <span class="s2">"What is your name"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="n">sender</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s2">"My codename is '"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">"'"</span><span class="p">)</span>
            <span class="c1">#If giving a name, register the name as being from that neighbor.</span>
            <span class="k">if</span> <span class="s2">"My codename"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbor_names</span><span class="p">[</span><span class="n">sender</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> 
                        <span class="nb">str</span><span class="p">(</span><span class="n">sender</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">display_neighbors</span><span class="p">()</span>
            <span class="c1">#If the message is part of a conversation, identify the conversation</span>
            <span class="c1">#   and forawrad the message.</span>
            <span class="k">if</span> <span class="n">message</span><span class="p">[:</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"&gt;"</span><span class="p">)]</span> <span class="o">==</span> <span class="s2">"Conversation"</span><span class="p">:</span>
                <span class="c1">#Format of any conversation message:</span>
                <span class="c1">#   Conversation&gt;(sender)&gt;(recipent)&gt;(conversation tag)&gt; message</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">message</span><span class="p">[:</span><span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"&gt;"</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"&gt;"</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="c1">#Identify parts</span>
                    <span class="nb">sorted</span> <span class="o">=</span> <span class="kc">True</span>   <span class="c1">#A message from another client will always </span>
                                    <span class="c1">#   be sorted if it has a tag.</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">recipent</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">tag</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s2">"Conversation&gt;"</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">recipent</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">:]</span>
                    <span class="c1">#If the tag is not currenlty part of a conversation, make a </span>
                    <span class="c1">#   conversation to allow communication.</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">PlayerConversation</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                        <span class="n">target</span> <span class="o">=</span> <span class="n">recipent</span>
                        <span class="c1">#Make a new coversation tab and add it to the notebook</span>
                        <span class="n">talktracker</span> <span class="o">=</span> <span class="n">PlayerConversation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">window</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="ow">not</span> <span class="n">target</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">conversations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">talktracker</span><span class="p">)</span>
                        <span class="c1">#If the user is the recipent, register conversation as a</span>
                        <span class="c1">#   normal conversation</span>
                        <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                            <span class="c1">#Append conversation to notebook</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">conversations</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">talktracker</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">start</span><span class="p">)</span>
                            <span class="c1">#Set recipent of conversation as originator</span>
                            <span class="n">talktracker</span><span class="o">.</span><span class="n">set_recipent</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                            <span class="c1">#Tell conversation to send messages back to the sender</span>
                            <span class="c1">#   in order to communicate with the originator</span>
                            <span class="n">talktracker</span><span class="o">.</span><span class="n">accept_input</span><span class="p">(</span><span class="s2">"Server&gt; Send message to '"</span> <span class="o">+</span> 
                                    <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"' in order to reach ["</span> <span class="o">+</span> <span class="n">target</span> <span class="o">+</span> <span class="s2">"]"</span><span class="p">)</span>
                            <span class="c1">#Log conversation start</span>
                            <span class="n">talktracker</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Conversation opened between you and "</span> <span class="o">+</span> <span class="n">start</span><span class="p">)</span>
                        <span class="c1">#If not intended recipent, register conversation as a spy</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1">#Append conversation to notebook</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">conversations</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">talktracker</span><span class="p">,</span>
                                    <span class="n">text</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="n">recipent</span><span class="p">)</span>
                            <span class="c1">#Set sender as start to pose as the conversation originator</span>
                            <span class="n">talktracker</span><span class="o">.</span><span class="n">set_sender</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                            <span class="c1">#Attempt to find the shortest path to the recipent by</span>
                            <span class="c1">#   requesting it from the server</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s2">"&lt;"</span> <span class="o">+</span> <span class="n">talktracker</span><span class="o">.</span><span class="n">tag</span> <span class="o">+</span> <span class="s2">"&gt; Get route '"</span> <span class="o">+</span> <span class="n">target</span> <span class="o">+</span> <span class="s2">"'"</span><span class="p">)</span>
                            <span class="c1">#Log the conversation for user to see</span>
                            <span class="n">talktracker</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Spying on conversation between "</span> <span class="o">+</span> <span class="n">start</span> <span class="o">+</span> <span class="s2">" and "</span> <span class="o">+</span> <span class="n">target</span><span class="p">)</span>
                            <span class="c1">#Register a back method to talk to the user and be a</span>
                            <span class="c1">#   bridge for the two different clients to communicate</span>
                            <span class="n">talktracker</span><span class="o">.</span><span class="n">sender_connection</span> <span class="o">=</span> <span class="n">sender</span>
                    <span class="c1">#Find conversation who corresponds to the tag (Including a </span>
                    <span class="c1">#   conversation that was just made) and forward the message</span>
                    <span class="k">for</span> <span class="n">conversation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conversations</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">conversation</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">tag</span><span class="p">:</span>
                            <span class="n">conversation</span><span class="o">.</span><span class="n">accept_input</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="n">recipent</span> <span class="o">+</span> <span class="s2">"&gt; "</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>
        <span class="c1">#If the message was not sorted, log it to the user</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">sorted</span><span class="p">:</span>
            <span class="c1">#If the sender was the server, tell the user</span>
            <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Server&gt; "</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>
            <span class="c1">#Otherwise, log the user it came from and display the message</span>
            <span class="k">elif</span> <span class="n">sender</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"&gt; "</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="sd">"""Gets the name of a neighbor if applicable</span>
<span class="sd">        </span>
<span class="sd">        Checks all the users who are connected and if the user has a name, this</span>
<span class="sd">        method will return the name of the neighbor based on his or her either</span>
<span class="sd">        connection to this GameClient</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            user: ClientThread or UserThread that the neighbor communicates from.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            The String name of the the neighbor or the neighbors address in the </span>
<span class="sd">            format of "ip:port" if the user does not have a name yet.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbor_names</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbor_names</span><span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">"""Gets the connection thread for a user based on the neighbor's name</span>
<span class="sd">        </span>
<span class="sd">        Iterates through the different connections and if the connection's name </span>
<span class="sd">        is the same as the given name, returns the connection.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            name: Name of the neighbor to search for.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            The UserThread or ClientThread of the neighbor or None if there is </span>
<span class="sd">            no neighbor with the given name.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">conn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbor_names</span><span class="p">[</span><span class="n">conn</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">conn</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">user_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="sd">"""This method will be called every time a user connects to the server</span>
<span class="sd">        </span>
<span class="sd">        This parses the user and logs then event. Then it polls the other user</span>
<span class="sd">        for his or her name and saves the user as a neighbor.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            user: UserThread created when a player connected</span>
<span class="sd">        """</span>
        <span class="c1">#Add connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="c1">#Register self as a listener</span>
        <span class="n">user</span><span class="o">.</span><span class="n">add_listener</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1">#Save the neighbor as the name "ip:port"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1">#Log event</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Neighbor connected to you "</span> <span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">display_neighbors</span><span class="p">()</span>   <span class="c1">#update display</span>
        <span class="c1">#Request the name of the other user and give my name</span>
        <span class="n">user</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s2">"What is your name?, "</span> <span class="o">+</span> <span class="s2">"My codename is '"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">"'"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">user_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="sd">"""This method will be called every time a use disconnects</span>
<span class="sd">        </span>
<span class="sd">        This clears the records of the user and then adjusts the connections </span>
<span class="sd">        accordingly.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            user: UserThread disconnecting from the server.</span>
<span class="sd">        """</span>
        <span class="c1">#If the user was connected clear data</span>
        <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbors</span><span class="p">:</span>
            <span class="c1">#Remove from list of neighbors</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">display_neighbors</span><span class="p">()</span>   <span class="c1">#update display</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbor_names</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbor_names</span><span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    
    <span class="k">def</span> <span class="nf">is_disconnected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
        <span class="sd">"""This method is called when the user is disconnected from the server</span>
<span class="sd">        </span>
<span class="sd">        Upon disconnecting, check if it is from the server or from another node </span>
<span class="sd">        in the network then act accordingly to close connections or remove the </span>
<span class="sd">        disconnected user.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            sender: UserThread or ClientThread who is disconnecting.</span>
<span class="sd">        """</span>
        <span class="c1">#If the server disconnected.</span>
        <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">on_disconnect</span><span class="p">()</span>
        <span class="c1">#If disconnected from another node</span>
        <span class="k">elif</span> <span class="n">sender</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sender</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">sender</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sender</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">display_neighbors</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">sender</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sender</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sender</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbor_names</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">neighbor_names</span><span class="p">[</span><span class="n">sender</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">":"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sender</span><span class="o">.</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Closes client and disconnects form all connected nodes"""</span>
        <span class="c1">#If connected to server, disconnect</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">close_server</span><span class="p">()</span>
        <span class="c1">#while connected to other users, disconnect from other users</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">ConversationWindow</span><span class="p">(</span><span class="n">Frame</span><span class="p">):</span>
    <span class="sd">"""A conversation window represents a conversation between two players</span>
<span class="sd">    </span>
<span class="sd">    The conversation window is a GUI display of a message log between two nodes</span>
<span class="sd">    and allows communication between the nodes.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        textares: scrolledtext panel of the conversation log.</span>
<span class="sd">        send: send text entry to send a message.</span>
<span class="sd">        button: button to send text.</span>
<span class="sd">        conn: connection to other user as a UserThread or ClientThread</span>
<span class="sd">    """</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">"""Creates a ConversationWindow</span>
<span class="sd">        </span>
<span class="sd">        Initializes all the parts of the window and allows sending messages via </span>
<span class="sd">        the GUI if enabled.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            parent: Parent panel or component.</span>
<span class="sd">            enabled: Can the user send messages via pressing the 'send' button</span>
<span class="sd">        """</span>
        <span class="c1">#Call super constructor</span>
        <span class="n">Frame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="c1">#Create scrolled text area and place it in the view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textarea</span> <span class="o">=</span> <span class="n">ScrolledText</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textarea</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">columnspan</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">sticky</span> <span class="o">=</span> <span class="n">N</span><span class="o">+</span><span class="n">E</span><span class="o">+</span><span class="n">S</span><span class="o">+</span><span class="n">W</span><span class="p">)</span>
        <span class="c1">#Create text entry area and place it in the view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span> <span class="o">=</span> <span class="n">N</span><span class="o">+</span><span class="n">E</span><span class="o">+</span><span class="n">S</span><span class="o">+</span><span class="n">W</span><span class="p">)</span>
        <span class="c1">#Create button and place it into the view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"send"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1">#Setup text area to be view only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textarea</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"disabled"</span><span class="p">)</span>
        <span class="c1">#configure grid and columns to expand</span>
        <span class="n">Grid</span><span class="o">.</span><span class="n">columnconfigure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Grid</span><span class="o">.</span><span class="n">rowconfigure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1">#Initialize connection field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#Bind button to call self.send_action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">"&lt;Button-1&gt;"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_action</span><span class="p">)</span>
        <span class="c1">#disable button if not enabled</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_button</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">enable_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Enables the button for send action"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"normal"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">disable_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Disabled the button for send action"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"disabled"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">"""Adds a line to the textarea</span>
<span class="sd">        </span>
<span class="sd">        Adds a line to the user view and adds a new line character to the end of</span>
<span class="sd">        the given line to add.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            line: Line of text to add.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textarea</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"normal"</span><span class="p">)</span>   <span class="c1">#Allow editing of text area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textarea</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">END</span><span class="p">,</span> <span class="n">line</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>      <span class="c1">#Tack on the line at the end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textarea</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s2">"end"</span><span class="p">)</span>                    <span class="c1">#Change line display area    </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textarea</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"disabled"</span><span class="p">)</span> <span class="c1">#Stop editing of text area</span>
    
    <span class="k">def</span> <span class="nf">add_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">):</span>
        <span class="sd">"""Sets the recipent of this conversation</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            conn: ClientThread or UserThread that receives messages from the </span>
<span class="sd">                    send_action method.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">conn</span>
    
    <span class="k">def</span> <span class="nf">remove_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Resets the recipent of this conversation to None"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">"""Send a message to the recipent</span>
<span class="sd">        </span>
<span class="sd">        If the connection (self.conn) is None, 'You are nto connected to anything'</span>
<span class="sd">        is displayed on the screen and the action is aborted. If the conversation</span>
<span class="sd">        is connected, then the message is sent using conn.send_message(message)</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            message: String message to send.</span>
<span class="sd">        """</span>
        <span class="c1">#If not connected</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"You are not connected to anything"</span><span class="p">)</span>
        <span class="c1">#If connected</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Check to make sure it is not an empty message</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="c1">#Send message if it is a non-empty string</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">"end"</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"You&gt; "</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">send_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">"""Send action called by the button to forward message in send entry"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">PlayerConversation</span><span class="p">(</span><span class="n">ConversationWindow</span><span class="p">):</span>
    <span class="sd">"""A player conversation is Conversation between two players</span>
<span class="sd">    </span>
<span class="sd">    This is a conversation window designed to oversee a conversation between two</span>
<span class="sd">    players or for a spy to watch two other players' conversation</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        protocol: Communicatin protocol.</span>
<span class="sd">        tag: Identifier for this conversation.</span>
<span class="sd">        target: Intended recipent of the conversation.</span>
<span class="sd">        recipent: Same as target if not spy, but if spy, the target is the </span>
<span class="sd">                original sender.</span>
<span class="sd">        sender: Self if not spy, but if spy, the origial starter of the conversation.</span>
<span class="sd">        game_client: GameClient operating the ClientInterface.</span>
<span class="sd">        queue: Queue of messages to forward if disconnected.</span>
<span class="sd">        </span>
<span class="sd">        is_spy: Is this a spy window.</span>
<span class="sd">        sender_connection: Back communication to send messages to both the target</span>
<span class="sd">            and the sender for spy windows.</span>
<span class="sd">        block: Should block communications between both parties?</span>
<span class="sd">    """</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1">#Tags currently reserved by active conversations        </span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game_client</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_spy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""Creates a PlayerConversation with given attributes to be a spy or not</span>
<span class="sd">        </span>
<span class="sd">        Will create and setup a player conversation. If there is no tag, it is</span>
<span class="sd">        assumed that this is a new conversation and therefore a new tag is </span>
<span class="sd">        created that has not already been reserved by another conversation. If </span>
<span class="sd">        this window has no protocol, it will assume that the conversation has </span>
<span class="sd">        been started by another player and wait for that player to communicate </span>
<span class="sd">        which protocol he or she wishes to use.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            game_client: GameClient operating the ClientInterface.</span>
<span class="sd">            tag: Tag to use for conversation or None if this is a new conversation.</span>
<span class="sd">            is_spy: Is this a spy window.</span>
<span class="sd">            protocol: Protocol to use in order to communicate with the other user</span>
<span class="sd">                    or None to wait for the other user to select a protocol.</span>
<span class="sd">        """</span>
        <span class="c1">#Call super constructor</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_spy</span> <span class="o">=</span> <span class="n">is_spy</span>        <span class="c1">#Register fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">protocol</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>             <span class="c1">#Generate tag if needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">64</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">PlayerConversation</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">64</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="c1">#Add tag to list</span>
        <span class="n">PlayerConversation</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>          <span class="c1">#Initialize fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sender_connection</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sender</span> <span class="o">=</span> <span class="n">game_client</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game_client</span> <span class="o">=</span> <span class="n">game_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">IntVar</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">protocol</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>    <span class="c1">#If this has a protocol, do setup for protocol</span>
            <span class="n">protocol</span><span class="o">.</span><span class="n">set_conversation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">set_sender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
        <span class="sd">"""Sets the sender of the conversation</span>
<span class="sd">        </span>
<span class="sd">        Used to create spy windows</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            sender: Name of intended sender.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sender</span> <span class="o">=</span> <span class="n">sender</span>
    
    <span class="k">def</span> <span class="nf">set_recipent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recipent</span><span class="p">):</span>
        <span class="sd">"""Sets the recipent of the conversation</span>
<span class="sd">        </span>
<span class="sd">        Used to create spy windows</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            recipent: Name of intended recipent.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span> <span class="o">=</span> <span class="n">recipent</span>
    
    <span class="k">def</span> <span class="nf">accept_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">"""Accepts and processes input from a socket</span>
<span class="sd">        </span>
<span class="sd">        Parses the input in an expected format of:</span>
<span class="sd">            "sender&gt;recipent&gt; message" or</span>
<span class="sd">            "Server&gt; message" for messages from the server.</span>
<span class="sd">        Then determines whether to display or forward the message or do something</span>
<span class="sd">        else if the protocol requests it</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            message: Message in expected format</span>
<span class="sd">        """</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="n">message</span><span class="p">[:</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"&gt;"</span><span class="p">)]</span>    <span class="c1">#Identify sender</span>
        <span class="c1">#If sent by server</span>
        <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="s2">"Server"</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#Find fastest path</span>
            <span class="c1">#If there is no path, abort</span>
            <span class="k">if</span> <span class="s2">"is not connected to the game"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>   <span class="c1">#Not connected == no path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Cannot connect to "</span> <span class="o">+</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)</span> 
                        <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)]</span> <span class="o">+</span> <span class="s2">". Send 'Close' to exit this tab"</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">"Cannot reach"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>                 <span class="c1">#Can't reach == no path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Cannot reach "</span> <span class="o">+</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> 
                        <span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)]</span> <span class="o">+</span> <span class="s2">". Send 'Close' to exit this tab"</span><span class="p">)</span>
            <span class="c1">#If the person him/herself is the intended recipent, abort</span>
            <span class="k">elif</span> <span class="s2">"Cannot start conversation with yourself"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Narcissist, send 'Close' to exit this tab"</span><span class="p">)</span>
            <span class="c1">#If target is found, register the recipent/connection</span>
            <span class="k">elif</span> <span class="s2">"in order to reach"</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="c1">#Find target to send messages to</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">"</span><span class="se">\'</span><span class="s2">"</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_client</span><span class="o">.</span><span class="n">get_connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">))</span>
                <span class="c1">#Identify who messages are comming from</span>
                <span class="n">recipent</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"["</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"]"</span><span class="p">)]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span> <span class="o">=</span> <span class="n">recipent</span>
                <span class="c1">#If this is not a spy</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spy</span><span class="p">:</span>
                    <span class="c1">#If there is a spy protocol, start it</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s2">"Conversation&gt;"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span> <span class="o">+</span>
                                <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">+</span> <span class="s2">"&gt; "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">set_conversation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">on_start</span><span class="p">()</span>
                <span class="c1">#If this is a spy, setup spy fields and GUI</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#Second set of buttons and entries for spying and posing as</span>
                    <span class="c1">#   either user to steal information.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">send2</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">send2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span> <span class="o">=</span> <span class="n">N</span><span class="o">+</span><span class="n">E</span><span class="o">+</span><span class="n">S</span><span class="o">+</span><span class="n">W</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">button2</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"send to "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="s2">"send to "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">button2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"As "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span> <span class="o">=</span> <span class="n">N</span><span class="o">+</span><span class="n">E</span><span class="o">+</span><span class="n">S</span><span class="o">+</span><span class="n">W</span><span class="p">)</span>
                    <span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"As "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sticky</span> <span class="o">=</span> <span class="n">N</span><span class="o">+</span><span class="n">E</span><span class="o">+</span><span class="n">S</span><span class="o">+</span><span class="n">W</span><span class="p">)</span>
                    <span class="n">Grid</span><span class="o">.</span><span class="n">columnconfigure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">Grid</span><span class="o">.</span><span class="n">rowconfigure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                    
                    <span class="c1">#Setup new button action</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">button</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">"&lt;Button-1&gt;"</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_action</span><span class="p">(</span>
                            <span class="n">event</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">button2</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">"&lt;Button-1&gt;"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_action</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">button2</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">"&lt;Button-1&gt;"</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_action</span><span class="p">(</span>
                            <span class="n">event</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">recipent</span><span class="p">))</span>
                    
                    <span class="c1">#Create button to block communications</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">blockbutton</span> <span class="o">=</span> <span class="n">Checkbutton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Block comms"</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">blockbutton</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">column</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sticky</span> <span class="o">=</span> <span class="n">N</span><span class="o">+</span><span class="n">E</span><span class="o">+</span><span class="n">S</span><span class="o">+</span><span class="n">W</span><span class="p">)</span>
                <span class="c1">#After making a connection, run through the queue sending all </span>
                <span class="c1">#   queued messages.</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1">#If the message was not sent by the server</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Identify message parts</span>
            <span class="c1">#   "Sender&gt;Recipent&gt; message"</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"&gt;"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="n">recipent</span> <span class="o">=</span> <span class="n">message</span><span class="p">[:</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"&gt;"</span><span class="p">)]</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="n">message</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"&gt;"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:]</span>
            <span class="c1">#If there is a protocol and this is not a spy window</span>
            <span class="c1">#   Setup a protocol based on the message received</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spy</span><span class="p">:</span>
                <span class="n">protocol</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="c1">#Choose protocol based on message</span>
                <span class="k">if</span> <span class="n">protocol</span> <span class="o">==</span> <span class="s2">"None"</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">NoneProtocol</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">protocol</span> <span class="o">==</span> <span class="s2">"Reverse"</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">ReverseProtocol</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">protocol</span> <span class="o">==</span> <span class="s2">"XOR"</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">XORProtocol</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">protocol</span> <span class="o">==</span> <span class="s2">"DH"</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">DHProtocol</span><span class="p">()</span>
                <span class="c1">#If a protocol could be found, setup the protocol</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">set_conversation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">on_start</span><span class="p">()</span>
                <span class="c1">#Return and do not display this message</span>
                <span class="k">return</span>  
            <span class="c1">#If there now is a protocol, have the protocol process the message</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">before_process</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">recipent</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
            <span class="c1">#If the message is "CANCEL_MESSAGE" (Set by protocol), do not display it</span>
            <span class="k">if</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">"CANCEL_MESSAGE"</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="c1">#If the message passed all the previous tests, process it and then</span>
            <span class="c1">#   display it on the screen.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_message</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">recipent</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">process_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">recipent</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">"""This will process a message before displaying it on the screen</span>
<span class="sd">        </span>
<span class="sd">        Depending on whether this is a spy window or not, this instance will </span>
<span class="sd">        interpret the fields differently and possilby forward or modify the </span>
<span class="sd">        message before displaying it if this instance is a spy. If this instance</span>
<span class="sd">        is not a spy, it will simply display the message.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            sender: Person sending the message.</span>
<span class="sd">            recipent: Person receiving the message.</span>
<span class="sd">            message: Message being sent.</span>
<span class="sd">        """</span>
        <span class="c1">#If this instance is the intended recipent, simply display the message.</span>
        <span class="k">if</span> <span class="n">recipent</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_client</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">sender</span> <span class="o">+</span> <span class="s2">"&gt; "</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>
        <span class="c1">#If this instance is not the intended recipent, it gets complicated</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#If not blocing message, log on screen.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">sender</span> <span class="o">+</span> <span class="s2">"&gt; "</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>
            <span class="c1">#If blocking messages, log that the message was blocked and exit.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">sender</span> <span class="o">+</span> <span class="s2">" [BLOCKED]&gt; "</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>
                <span class="k">return</span>
            
            <span class="c1">#If not connected, note that this is not connected and add the message</span>
            <span class="c1">#   to the queue.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Not connected to anything yet, added message to queue"</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"Conversation&gt;"</span> <span class="o">+</span> <span class="n">sender</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span> 
                        <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">+</span> <span class="s2">"&gt; "</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>
            <span class="c1">#If the recipent is the target (the recipent of the message is the </span>
            <span class="c1">#   end target of the conversation) forward the message to the target</span>
            <span class="k">elif</span> <span class="n">recipent</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s2">"Conversation&gt;"</span> <span class="o">+</span> <span class="n">sender</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="n">recipent</span> 
                        <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>
            <span class="c1">#If the recipent is the sender (the reciepnt of the message is the </span>
            <span class="c1">#   oritinal starter of the conversation) forward message to sender</span>
            <span class="k">elif</span> <span class="n">recipent</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sender_connection</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s2">"Conversation&gt;"</span> <span class="o">+</span> <span class="n">sender</span> <span class="o">+</span> 
                        <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="n">recipent</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""Send action called by the button to forward message in send entry and</span>
<span class="sd">            passes a source"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">source</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""Sends a message with a source and message </span>
<span class="sd">        </span>
<span class="sd">        Depending on the source and whether or not this is a spy, the recipent </span>
<span class="sd">        of the message will be determined. If this instance is not a spy, then </span>
<span class="sd">        the recipent will by the intended recipent and the source is the client</span>
<span class="sd">        him or herself. If this instance is a spy, then the source is either the</span>
<span class="sd">        target or the starter and the recipent will be determined to be whichever</span>
<span class="sd">        the source is not (target to starter or starter to target).</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            message: Message to send.</span>
<span class="sd">            source: Person sending the message.</span>
<span class="sd">        """</span>
        <span class="c1">#If there is no otherwise specified source, source is the person him/herself</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_client</span><span class="o">.</span><span class="n">name</span>
        <span class="c1">#If the source is the recipent, change the message for spy windows</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send2</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        
        <span class="c1">#Save an unmodified message</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="n">message</span>
        <span class="n">should_show</span> <span class="o">=</span> <span class="kc">True</span>      <span class="c1">#Determine wether the message should be shown </span>
                                <span class="c1">#   based on the protocol</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">should_show</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">before_send</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        
        <span class="c1">#If the message is 'CANCEL_MESSAGE', abort operation (usually done by the</span>
        <span class="c1">#   protocol to avoid displaying excess information)</span>
        <span class="k">if</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">"CANCEL_MESSAGE"</span><span class="p">:</span>
            <span class="k">return</span>
            
        <span class="c1">#If the message is 'close', exit this window</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"close"</span> <span class="ow">and</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_client</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="n">source</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_spy</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">send2</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"close"</span> <span class="ow">and</span> <span class="n">source</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span><span class="p">)):</span>
            <span class="c1">#forget this conversation (but if this was a spy window, it will continue</span>
            <span class="c1">#   to forward or block messages based on the last setting)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game_client</span><span class="o">.</span><span class="n">client_interface</span><span class="o">.</span><span class="n">conversations</span><span class="o">.</span><span class="n">forget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1">#If not closing the window, attempt to send the message</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#If not connected, say so then abort</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"You are not connected to anything yet"</span><span class="p">)</span>
            <span class="c1">#If connected, attempt to send</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#If empty message, abort</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="c1">#If non-empty message, attempt to send</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#If the source is the gameclient, send message as normal</span>
                    <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_client</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                        <span class="c1">#Send message in format:</span>
                        <span class="c1">#   'Converstaion&gt;source&gt;recipent&gt;tag&gt; message'</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s2">"Conversation&gt;"</span> <span class="o">+</span> <span class="n">source</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> 
                                <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>
                        <span class="c1">#Clear text entry box</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">"end"</span><span class="p">)</span>
                        <span class="c1">#If the message whould be displayed, display it</span>
                        <span class="k">if</span> <span class="n">should_show</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"You&gt; "</span> <span class="o">+</span> <span class="n">normal</span><span class="p">)</span>
                    <span class="c1">#If the source is the original starter of the conversation,</span>
                    <span class="c1">#   set the sender to be the modified source and the </span>
                    <span class="c1">#   recipent is the intended recipent of the conversation</span>
                    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">:</span>
                        <span class="c1">#Send message in format:</span>
                        <span class="c1">#   'Converstaion&gt;source&gt;recipent&gt;tag&gt; message'</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s2">"Conversation&gt;"</span> <span class="o">+</span> <span class="n">source</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> 
                                <span class="bp">self</span><span class="o">.</span><span class="n">sender</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>
                        <span class="c1">#Clear text entry box</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">"end"</span><span class="p">)</span>
                        <span class="c1">#If the message whould be displayed, display it</span>
                        <span class="k">if</span> <span class="n">should_show</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"You as "</span> <span class="o">+</span> <span class="n">source</span> <span class="o">+</span> <span class="s2">"&gt; "</span> <span class="o">+</span> <span class="n">normal</span><span class="p">)</span>
                    <span class="c1">#If the source is the intended recipent of the conversation,</span>
                    <span class="c1">#   set the sender to be the modified source and the </span>
                    <span class="c1">#   recipent is the original starter of the conversation</span>
                    <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span><span class="p">:</span>
                        <span class="c1">#Send message in format:</span>
                        <span class="c1">#   'Converstaion&gt;source&gt;recipent&gt;tag&gt; message'</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sender_connection</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s2">"Conversation&gt;"</span> <span class="o">+</span> <span class="n">source</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> 
                                <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">+</span> <span class="s2">"&gt;"</span> <span class="o">+</span> <span class="n">message</span><span class="p">)</span>
                        <span class="c1">#Clear text entry box</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send2</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">"end"</span><span class="p">)</span>
                        <span class="c1">#If the message whould be displayed, display it</span>
                        <span class="k">if</span> <span class="n">should_show</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"You as "</span> <span class="o">+</span> <span class="n">source</span> <span class="o">+</span> <span class="s2">"&gt; "</span> <span class="o">+</span> <span class="n">normal</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ClientInterface</span><span class="p">:</span>
    <span class="sd">"""A client interface is an interface that allows clients to play the game </span>
<span class="sd">        in a GUI setting.</span>
<span class="sd">    </span>
<span class="sd">    The Client interface has space for starting new conversations, viewing current</span>
<span class="sd">    conversations, viewing all users and neighbors, connecting to the server or </span>
<span class="sd">    disconnecting, displaying the codename of the client. The Client interface </span>
<span class="sd">    works with the GameClient to operate the game and keep it functioning for the</span>
<span class="sd">    user using the setup.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        window: Window of the application.</span>
<span class="sd">        neighbor_names: Dictionary of the neighbor names saved in format...</span>
<span class="sd">            "ip:port" by "name"</span>
<span class="sd">        client: Client connection to the server.</span>
<span class="sd">        is_updating: Is this currently updating the display.</span>
<span class="sd">        queued: Is there a display update queued.</span>
<span class="sd">        client_thread: ClientThread to communicate with the server.</span>
<span class="sd">        connect_thread: Thread for creating connection to the server.</span>
<span class="sd">        monitor: IP address entry for monitor.</span>
<span class="sd">        you: Entry area for the user's host IP identification.</span>
<span class="sd">        connect_button: Button to connect to server.</span>
<span class="sd">        disconnect_button: Button to disconnect from the server.</span>
<span class="sd">        status: Display of connection status.</span>
<span class="sd">        codename: Display of the user's codename.</span>
<span class="sd">        token_text: Display of the user's token and target.</span>
<span class="sd">        neighbor_text: Display of the user's neighbors and their IP addresses.</span>
<span class="sd">        all_players: List of players connected to the game.</span>
<span class="sd">        selected_player: Player selected to be recipent of conversation.</span>
<span class="sd">        recipent: Option menu to select recipent of conversation.</span>
<span class="sd">        methods: Possible methods of communication.</span>
<span class="sd">        selected_method: Selected method of communication.</span>
<span class="sd">        method: Option menu to select method of communication.</span>
<span class="sd">        converstaion_button: Button to start a converation.</span>
<span class="sd">        conversations: notebook of all conversations.</span>
<span class="sd">        server: ConversationWindow for communication with server and general feed</span>
<span class="sd">            for all messages to the user.</span>
<span class="sd">        token: Text entry to submit token.</span>
<span class="sd">        submit_token: Button to submit token.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_updating</span> <span class="o">=</span> <span class="kc">False</span>    <span class="c1">#Setup fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queued</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">window</span> <span class="o">=</span> <span class="n">Tk</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span>
        <span class="n">window</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Game Client"</span><span class="p">)</span> <span class="c1">#Setup window</span>
        <span class="n">window</span><span class="o">.</span><span class="n">protocol</span><span class="p">(</span> <span class="s2">"WM_DELETE_WINDOW"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">close</span> <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span><span class="c1">#Initialize more fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_thread</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_players</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1">#Create diplay area for connecting to server</span>
        <span class="c1">#Monitor entry</span>
        <span class="n">Label</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Monitor IP"</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
        <span class="c1">#User's ip entry</span>
        <span class="n">Label</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Your IP"</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">stick</span> <span class="o">=</span> <span class="s2">"n"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">you</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">you</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">END</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">you</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">stick</span> <span class="o">=</span> <span class="s2">"n"</span><span class="p">)</span>

        <span class="c1">#Create a panel to hold Connect and disconnect and status disply elements</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
        <span class="c1">#Create connect button and setup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Connect"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_button</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="s2">"left"</span><span class="p">,</span> <span class="n">padx</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>      <span class="c1">#Position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect_button</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">"&lt;Button-1&gt;"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect_action</span><span class="p">)</span>
                                        <span class="c1">#Bind action to self.connect_action</span>
        <span class="c1">#Create disconnect button and setup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Disconnect"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_button</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="s2">"left"</span><span class="p">,</span> <span class="n">padx</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>   <span class="c1">#Position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_button</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">"&lt;Button-1&gt;"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_action</span><span class="p">)</span>
                                        <span class="c1">#Bind action to self.disconnect_action</span>
        <span class="c1">#Create status for server connection area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Connection Status: Not Connected"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="s2">"left"</span><span class="p">,</span> <span class="n">padx</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>      <span class="c1">#Position</span>
        <span class="c1">#Create a codename display text field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codename</span> <span class="o">=</span> <span class="n">Label</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Codename: (Waiting for assignment)"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codename</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span> <span class="o">=</span> <span class="s2">"left"</span><span class="p">,</span> <span class="n">padx</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>    <span class="c1">#Position    </span>
        <span class="c1">#Position the panel in the grid</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">stick</span> <span class="o">=</span> <span class="s2">"w"</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>

        <span class="c1">#Create area for diplaying token</span>
        <span class="c1">#Label</span>
        <span class="n">Label</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Token:"</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
                <span class="n">columnspan</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sticky</span><span class="o">=</span><span class="s2">"w"</span><span class="p">)</span>
        <span class="c1">#Create selectable token and target display field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token_text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="s2">"disabled"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_token_text</span><span class="p">(</span><span class="s2">"No token yet"</span><span class="p">)</span>     <span class="c1">#Set field text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token_text</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">columnspan</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>   <span class="c1">#Position</span>

        <span class="c1">#Create area to show current neighbors</span>
        <span class="c1">#Label</span>
        <span class="n">Label</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Neighbors:"</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                <span class="n">columnspan</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sticky</span> <span class="o">=</span> <span class="s2">"w"</span><span class="p">)</span>
        <span class="c1">#Create text area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_text</span> <span class="o">=</span> <span class="n">ScrolledText</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="s2">"disabled"</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
        <span class="c1">#Position the text area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_text</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">columnspan</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
        <span class="c1">#Update display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_neighbors</span><span class="p">()</span>
        
        <span class="c1">#Create a frame for starting a new conversation</span>
        <span class="n">start_tab</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
        <span class="c1">#Label the frame</span>
        <span class="n">Label</span><span class="p">(</span><span class="n">start_tab</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Start Conversation"</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">40</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1">#Create area for recipent of the converation</span>
        <span class="n">Label</span><span class="p">(</span><span class="n">start_tab</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Recipent:"</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">padx</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">sticky</span> <span class="o">=</span> <span class="s2">"w"</span><span class="p">)</span>
        <span class="c1">#Setup fields to track player selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_player</span> <span class="o">=</span> <span class="n">StringVar</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
        <span class="c1">#Allow player to select from a drop down menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span> <span class="o">=</span> <span class="n">OptionMenu</span><span class="p">(</span><span class="n">start_tab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_player</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">all_players</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">padx</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">sticky</span> <span class="o">=</span> <span class="s2">"w"</span><span class="p">)</span>
        <span class="c1">#Update the display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_players</span><span class="p">()</span>

        <span class="c1">#Create an area for selecting encryption method</span>
        <span class="n">Label</span><span class="p">(</span><span class="n">start_tab</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Encryption Method:"</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">padx</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">stick</span> <span class="o">=</span> <span class="s2">"w"</span><span class="p">)</span>
        <span class="c1">#List all possible methods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"None"</span><span class="p">,</span> <span class="s2">"None"</span><span class="p">,</span> <span class="s2">"Reverse"</span><span class="p">,</span> <span class="s2">"XOR"</span><span class="p">,</span> <span class="s2">"DH"</span><span class="p">]</span>
        <span class="c1">#Field for selected method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_method</span> <span class="o">=</span> <span class="n">StringVar</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_method</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"None"</span><span class="p">)</span>    <span class="c1">#Set default to none</span>
        <span class="c1">#Create a drop down menu for selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">OptionMenu</span><span class="p">(</span><span class="n">start_tab</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_method</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">padx</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">stick</span> <span class="o">=</span> <span class="s2">"w"</span><span class="p">)</span>
        
        <span class="c1">#Create a button to start a new converation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">converstaion_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">start_tab</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Start Conversation"</span><span class="p">)</span>
        <span class="c1">#Position button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">converstaion_button</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">padx</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">stick</span> <span class="o">=</span> <span class="s2">"w"</span><span class="p">)</span>
        <span class="c1">#Bind button action to self.start_conversation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">converstaion_button</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">"&lt;Button-1&gt;"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_conversation</span><span class="p">)</span>
        
        <span class="c1">#Position the entire start converation tab</span>
        <span class="n">start_tab</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">columnspan</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">stick</span> <span class="o">=</span> <span class="s2">"w"</span><span class="p">)</span>

        <span class="c1">#Create a notebook for all converations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conversations</span> <span class="o">=</span> <span class="n">Notebook</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
        <span class="c1">#Position notebook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conversations</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rowspan</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">stick</span> <span class="o">=</span> <span class="n">N</span><span class="o">+</span><span class="n">E</span><span class="o">+</span><span class="n">S</span><span class="o">+</span><span class="n">W</span><span class="p">,</span> <span class="n">padx</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
        <span class="c1">#Create a window for server comms and general information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">ConversationWindow</span><span class="p">()</span>
        <span class="c1">#Log start </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Not connected to server yet"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conversations</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Server"</span><span class="p">)</span>

        <span class="c1">#Setup grid and column expansion</span>
        <span class="n">Grid</span><span class="o">.</span><span class="n">columnconfigure</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Grid</span><span class="o">.</span><span class="n">rowconfigure</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1">#Create an area for submitting a tokoen</span>
        <span class="n">Label</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Submit Token"</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">columnspan</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">stick</span> <span class="o">=</span> <span class="s2">"n"</span><span class="p">)</span>
        <span class="c1">#Entry area for the token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">stick</span> <span class="o">=</span> <span class="s2">"n"</span><span class="p">)</span>
        <span class="c1">#Button to submit token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">submit_token</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Submit"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">submit_token</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pady</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">stick</span> <span class="o">=</span> <span class="s2">"n"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">submit_token</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">"&lt;Button-1&gt;"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">submit_action</span><span class="p">)</span>
        
        <span class="c1">#Start the window</span>
        <span class="n">window</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">start_conversation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">"""Starts a converation when the button is pressed"""</span>
        <span class="c1">#If connected to the server</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_thread</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#Find target</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_player</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="c1">#Find protocol (if possible)</span>
            <span class="n">protocol</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_method</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"None"</span><span class="p">:</span>
                <span class="n">protocol</span> <span class="o">=</span> <span class="n">NoneProtocol</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_method</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"Reverse"</span><span class="p">:</span>
                <span class="n">protocol</span> <span class="o">=</span> <span class="n">ReverseProtocol</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_method</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"XOR"</span><span class="p">:</span>
                <span class="n">protocol</span> <span class="o">=</span> <span class="n">XORProtocol</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_method</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"DH"</span><span class="p">:</span>
                <span class="n">protocol</span> <span class="o">=</span> <span class="n">DHProtocol</span><span class="p">()</span>
            <span class="c1">#Create a PlayerConversation based on specified target and protocol</span>
            <span class="n">talktracker</span> <span class="o">=</span> <span class="n">PlayerConversation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span> <span class="n">protocol</span> <span class="o">=</span> <span class="n">protocol</span><span class="p">)</span>
            <span class="c1">#Log converation start</span>
            <span class="n">talktracker</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Conversation opened between you and "</span> <span class="o">+</span> <span class="n">target</span><span class="p">)</span>
            <span class="c1">#Add PlayerConversation to notebook</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game_client</span><span class="o">.</span><span class="n">conversations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">talktracker</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conversations</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">talktracker</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">target</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conversations</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">talktracker</span><span class="p">)</span>  <span class="c1">#Show new tab</span>
            
            <span class="c1">#Find fastest route to target via the server.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s2">"&lt;"</span> <span class="o">+</span> <span class="n">talktracker</span><span class="o">.</span><span class="n">tag</span> <span class="o">+</span> <span class="s2">"&gt; Get route '"</span> <span class="o">+</span> <span class="n">target</span> <span class="o">+</span> <span class="s2">"'"</span><span class="p">)</span>
        <span class="c1">#If not connected to the server, abort and log</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"You are not connected to the server"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">set_token_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">"""Sets the text of the token_text fields</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            text: String of what the token_text field should be set to.</span>
<span class="sd">        """</span>
        <span class="c1">#Enable editing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token_text</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s2">"normal"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token_text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">END</span><span class="p">)</span>     <span class="c1">#Delete old text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token_text</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>   <span class="c1">#Set new text</span>
        <span class="c1">#Disable editing and adjust width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token_text</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s2">"disabled"</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">submit_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">"""Submit a token to the server based on button press"""</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s2">"Token submission: '"</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"'"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">display_players</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Update display of players in the recipent menu to start converations"""</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recipent</span><span class="p">[</span><span class="s1">'menu'</span><span class="p">]</span>
        <span class="n">m</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">END</span><span class="p">)</span>     <span class="c1">#Clear out old option</span>
        <span class="c1">#Add new options if there are plays</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_players</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_players</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">val</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="k">lambda</span> <span class="n">v</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_player</span><span class="p">,</span><span class="n">l</span><span class="o">=</span><span class="n">val</span><span class="p">:</span><span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
            <span class="c1">#If the previously selected player is no longer in the list, select</span>
            <span class="c1">#   the first player in the list</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_player</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_players</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selected_player</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_players</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#If there are no options, just set it to an empty, descriptive value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_player</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"Select Recipent"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">display_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Display the neighbors in the neighbors field"""</span>
        <span class="c1">#If currently updating neighbors, queue aciton and abort</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_updating</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queued</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>
        <span class="c1">#note that this is in action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_updating</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1">#Allow the text to be edited</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_text</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"normal"</span><span class="p">)</span>
        <span class="c1">#Delete the text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">"1.0"</span><span class="p">,</span> <span class="s2">"end"</span><span class="p">)</span>
        <span class="c1">#If there are no neighbors, note that</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_text</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">"end"</span><span class="p">,</span> <span class="s2">"You have no neighbors"</span><span class="p">)</span>
        <span class="c1">#If there are neighbors, add them to the list with their name, if applicable</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">)):</span>
                <span class="c1">#If the neighbor does not have a name, show the neighbor ip</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_names</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_text</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">"end"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
                <span class="c1">#If the neighbor has a name, show the name and ip</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_text</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s2">"end"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_names</span><span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span> <span class="o">+</span> <span class="s2">" - "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
        <span class="c1">#Disable editing of the text area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_text</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">state</span> <span class="o">=</span> <span class="s2">"disabled"</span><span class="p">)</span>
        <span class="c1">#Note that this is no longer editing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_updating</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#If there is an action queued, empty queue and repeat action</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">queued</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queued</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display_neighbors</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Close the game"""</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Bye bye"</span><span class="p">)</span>
        <span class="c1">#If connected, disconnect and close the client </span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_thread</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_thread</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1">#Run normal disconnect actions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_disconnect</span><span class="p">()</span>
        <span class="c1">#Exit the program</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">connect_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Attempt to connect to the server"""</span>
        <span class="c1">#If not currently connected, attempt to connect</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_thread</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#Get specified address</span>
            <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="c1">#Note start of action</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Attempting to connect using address: "</span> <span class="o">+</span> <span class="n">address</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>           <span class="c1">#Get socket</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">address</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>    <span class="c1">#attempt to connect</span>
                <span class="c1">#Attempt to make client thread</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_thread</span> <span class="o">=</span> <span class="n">ClientThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">,</span> <span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
                <span class="c1">#Make game client based on client thread</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">game_client</span> <span class="o">=</span> <span class="n">GameClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_thread</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="c1">#Add listener to actions and note success</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client_thread</span><span class="o">.</span><span class="n">add_listener</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_client</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Succesfully connected to monitor "</span> <span class="o">+</span> <span class="n">address</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="s2">"Connection Status: Connected"</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_thread</span><span class="p">)</span>
                <span class="k">return</span>                                  <span class="c1">#if successful, exit</span>
            <span class="c1">#If there is an error, log the error</span>
            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">herror</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"error with address "</span> <span class="o">+</span> <span class="n">address</span> <span class="o">+</span> <span class="s2">" error of "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"error occured with setting up socket: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
            <span class="c1">#If unsuccessful, reset client to None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#If connected, note that this is already connected to server</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Already connected to server"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">disconnect_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">"""Disconnect action from disconnect button"""</span>
        <span class="c1">#If connected, cose client and disconnect</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_thread</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_thread</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Disconnected from game"</span><span class="p">)</span>
        <span class="c1">#If not connected, note that this is not connected</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"You are not connected to the server"</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">connect_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">"""Connect ation from connect button"""</span>
        <span class="c1">#If not currently connection, try to connect</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect_thread</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect_thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
            <span class="c1">#export operation to thread to avoid delaying the display</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connect_server</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="c1">#If already connected, do not attempt to connect and note action</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s2">"Already attempting to connect to server"</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">on_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""This method is called whenever the client disconnects</span>

<span class="sd">        The mehtod resets the fields to allow a reconnect or close of the client </span>
<span class="sd">        without any extra threads running"""</span>
        <span class="c1">#If connected, clear converations and close connection</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_thread</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">conv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_client</span><span class="o">.</span><span class="n">conversations</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">conv</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="ow">and</span> <span class="n">conv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">conversations</span><span class="o">.</span><span class="n">tabs</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">conversations</span><span class="o">.</span><span class="n">forget</span><span class="p">(</span><span class="n">conv</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_thread</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1">#Reset fields for displaying connection, codename and token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="s2">"Connection Status: Not Connected"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codename</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="s2">"Codename: (Waiting for assignment)"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_token_text</span><span class="p">(</span><span class="s2">"No token yet"</span><span class="p">)</span>
        <span class="c1">#Clear out or reset fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_players</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1">#Update displays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_neighbors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_players</span><span class="p">()</span>

<span class="c1">#Start a client interface GUI that will be capable of operating all functions </span>
<span class="c1">#   and allows a player to create a game client to faciliate the game</span>
<span class="n">ClientInterface</span><span class="p">()</span>
</pre></div>

</div>

<p>This snippet took 0.05 seconds to highlight.</p>

<p>Back to the <a href="http://pygments.org/demo/">Entry List</a> or <a href="http://pygments.org/">Home</a>.</p>

<p style="font-size: xx-small"><a href="http://pygments.org/demo/6324310/delete/">Delete this entry (admin only)</a>.</p>

          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
      <div class="footer" role="contentinfo">
        © Copyright 2014, Georg Brandl and Pygments contributors.
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> . <br>
        Pygments logo created by <a href="http://dribbble.com/joelunger">Joel Unger</a>.
        Backgrounds from <a href="http://subtlepatterns.com/">subtlepatterns.com</a>.
      </div>
    </div> 
  
</body></html>